# Git worktree checkout - creates worktree for remote branch/PR
# Usage: wtcheckout <branch-name|pr-number>
if [ -z "$1" ]; then
  echo "Usage: wtcheckout <branch-name|pr-number>"
  return 1
fi

local input="$1"
local branch_name=""
local worktree_name=""

# Check if input is a PR number
if [[ "$input" =~ ^[0-9]+$ ]]; then
  branch_name=$(gh pr view "$input" --json headRefName -q '.headRefName' 2>/dev/null)
  if [ -z "$branch_name" ]; then
    echo "Could not find PR #$input"
    return 1
  fi
  worktree_name="pr-$input"
  echo "PR #$input: $branch_name"
else
  branch_name="$input"
  worktree_name="${branch_name//\//-}"
fi

local repo_root=$(git worktree list --porcelain | grep "^worktree" | head -1 | cut -d' ' -f2-)
local repo_name=$(basename "$repo_root")
local worktree_parent=$(dirname "$repo_root")

if [[ "$repo_name" == *.git ]]; then
  local worktree_path="$worktree_parent/$repo_name/$worktree_name"
else
  local worktree_path="$worktree_parent/$repo_name.git/$worktree_name"
fi

if [ -d "$worktree_path" ]; then
  echo "Worktree already exists at $worktree_path"
  cd "$worktree_path"
  return 0
fi

git fetch origin
git worktree add -b "$branch_name" "$worktree_path" "origin/$branch_name" 2>/dev/null || \
  git worktree add "$worktree_path" "$branch_name"
cd "$worktree_path"
wtsetup
